# Configuration for vikunja setup
name: vikunja

services:
  vikunja:
    image: vikunja/vikunja:0.24.6
    container_name: vikunja
    restart: unless-stopped
    ports:
      - target: 3456
        published: "3456"
        protocol: tcp
    volumes:
      - type: bind
        source: /DATA/AppData/$AppID/files
        target: /app/vikunja/files
    environment:
      VIKUNJA_SERVICE_PUBLICURL: ""
      VIKUNJA_DATABASE_HOST: vikunja-db
      VIKUNJA_DATABASE_PASSWORD: secret
      VIKUNJA_DATABASE_TYPE: mysql
      VIKUNJA_DATABASE_USER: vikunja
      VIKUNJA_DATABASE_DATABASE: vikunja
      VIKUNJA_SERVICE_JWTSECRET: change-me-to-a-random-secret-string
      VIKUNJA_SERVICE_ENABLEREGISTRATION: "true"
    depends_on:
      - vikunja-db
    networks:
      - vikunja-network
    x-casaos:
      envs:
        - container: VIKUNJA_SERVICE_PUBLICURL
          description:
            en_us: "Public URL (e.g., http://your-ip:3456)"
        - container: VIKUNJA_SERVICE_JWTSECRET
          description:
            en_us: "JWT secret for authentication"
        - container: VIKUNJA_DATABASE_PASSWORD
          description:
            en_us: "Database password (must match vikunja-db)"
      ports:
        - container: "3456"
          description:
            en_us: "WebUI Port"
      volumes:
        - container: /app/vikunja/files
          description:
            en_us: "Vikunja files storage"

  vikunja-db:
    image: mariadb:10.11
    container_name: vikunja-db
    restart: unless-stopped
    command:
      - --character-set-server=utf8mb4
      - --collation-server=utf8mb4_unicode_ci
      - --innodb-flush-method=fsync
    environment:
      MYSQL_ROOT_PASSWORD: supersecret
      MYSQL_USER: vikunja
      MYSQL_PASSWORD: secret
      MYSQL_DATABASE: vikunja
    volumes:
      - type: bind
        source: /DATA/AppData/$AppID/mysql
        target: /var/lib/mysql
    networks:
      - vikunja-network
    x-casaos:
      envs:
        - container: MYSQL_ROOT_PASSWORD
          description:
            en_us: "MariaDB root password"
        - container: MYSQL_PASSWORD
          description:
            en_us: "Database password for Vikunja"
      volumes:
        - container: /var/lib/mysql
          description:
            en_us: "MariaDB data storage"

  vikunja-mcp:
    image: ghcr.io/df-public/vikunja-mcp-server:latest
    container_name: vikunja-mcp
    restart: unless-stopped
    ports:
      - target: 3100
        published: "3100"
        protocol: tcp
    environment:
      VIKUNJA_API_URL: http://vikunja:3456/api/v1
      VIKUNJA_API_TOKEN: ""
      MCP_SERVER_PORT: "3100"
      MCP_SERVER_HOST: "0.0.0.0"
      MCP_AUTH_TOKEN: ""
      LOG_LEVEL: info
    depends_on:
      - vikunja
    networks:
      - vikunja-network
    x-casaos:
      envs:
        - container: VIKUNJA_API_TOKEN
          description:
            en_us: "Vikunja API token (create in Vikunja settings)"
        - container: MCP_AUTH_TOKEN
          description:
            en_us: "Optional auth token for MCP server"
        - container: LOG_LEVEL
          description:
            en_us: "Log level (debug, info, warn, error)"
      ports:
        - container: "3100"
          description:
            en_us: "MCP Server Port"

networks:
  vikunja-network:
    driver: bridge

x-casaos:
  architectures:
    - amd64
    - arm64
  main: vikunja
  author: DF_public
  category: Utilities
  description:
    en_us: |
      Vikunja is an open-source, self-hosted task management application.

      Features:
      - Task management with web UI
      - MariaDB database for persistence
      - MCP Server for Claude Code integration
      - Project organization
      - API integration support
  developer: Vikunja Team
  icon: https://vikunja.io/images/vikunja-logo.svg
  index: /
  port_map: "3456"
  scheme: http
  tagline:
    en_us: Self-hosted task management made simple
  thumbnail: https://vikunja.io/images/vikunja-logo.svg
  tips:
    before_install:
      en_us: |
        After installation:
        1. Change VIKUNJA_SERVICE_JWTSECRET
        2. Set VIKUNJA_SERVICE_PUBLICURL to your URL
        3. Disable registration after creating account
        4. For MCP: Create API token in Vikunja and set VIKUNJA_API_TOKEN
  title:
    en_us: Vikunja
